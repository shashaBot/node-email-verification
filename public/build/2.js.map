{"version":3,"sources":["../../src/pages/login/login.module.ts","../../src/directives/directives.module.ts","../../src/directives/ion-captcha/ion-captcha.ts","../../src/pages/login/login.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAyC;AACO;AACZ;AAE8B;AACI;AAgBtE,IAAa,eAAe;IAA5B;IAA8B,CAAC;IAAD,sBAAC;AAAD,CAAC;AAAlB,eAAe;IAd3B,+DAAQ,CAAC;QACR,YAAY,EAAE;YACZ,yDAAS;SACV;QACD,OAAO,EAAE;YACP,sEAAe,CAAC,QAAQ,CAAC,yDAAS,CAAC;YACnC,mEAAW;YACX,2EAAmB;YACnB,uFAAgB;SACjB;QACD,OAAO,EAAE;YACP,yDAAS;SACV;KACF,CAAC;GACW,eAAe,CAAG;AAAH;;;;;;;;;;;;;;;;;;;ACrBa;AACC;AAEsB;AAOhE,IAAa,gBAAgB;IAA7B;IAA+B,CAAC;IAAD,uBAAC;AAAD,CAAC;AAAnB,gBAAgB;IAL5B,+DAAQ,CAAC;QACT,YAAY,EAAE,CAAC,qFAAmB,CAAC;QACnC,OAAO,EAAE,CAAC,kEAAW,CAAC;QACtB,OAAO,EAAE,CAAC,qFAAmB,CAAC;KAC9B,CAAC;GACW,gBAAgB,CAAG;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACVuH;AACtB;AACzF;AAWrC,oEAAoE;AAGpE,IAAM,uBAAuB;IAE3B,iCAAqB,IAAW;QAAX,SAAI,GAAJ,IAAI,CAAO;IAChC,CAAC;IAED,+CAAa,GAAb,UAAe,KAAc;QAA7B,iBASC;QARC,MAAM,CAAC,UAAE,CAAmB;YAC1B,MAAM,CAAC,KAAI,CAAC,IAAI,CAAC,GAAG,CAAC,mBAAmB,EAAE,EAAE,MAAM,EAAE,EAAE,KAAK,SAAE,EAAE,CAAC,CAAC,GAAG,CAAC,aAAG,IAAI,UAAG,CAAC,IAAI,EAAE,EAAV,CAAU,CAAC,CAAC,GAAG,CAAC,aAAG;gBAC7F,EAAE,EAAE,CAAC,GAAG,CAAC,OAAQ,CAAC,CAAC,CAAC;oBAClB,MAAM,CAAC,EAAE,YAAY,EAAE,IAAI,EAAE;gBAC/B,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC;YACd,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IACH,8BAAC;AAAD,CAAC;AAfK,uBAAuB;IAD5B,iEAAU,EAAE;qCAGiB,mDAAI;GAF5B,uBAAuB,CAe5B;AAqBD,IAAa,mBAAmB;IAc9B,6BAAqB,OAAoB,EAAW,MAAe,EAAU,QAAmB,EAAU,uBAAiD;QAAtI,YAAO,GAAP,OAAO,CAAa;QAAW,WAAM,GAAN,MAAM,CAAS;QAAU,aAAQ,GAAR,QAAQ,CAAW;QAAU,4BAAuB,GAAvB,uBAAuB,CAA0B;QAZlJ,WAAM,GAAqB,EAAE,CAAC;QAG7B,oBAAe,GAAG,IAAI,2DAAY,EAAU,CAAC;QAC7C,mBAAc,GAAG,IAAI,2DAAY,EAAE,CAAC;IAS9C,CAAC;IAED,sCAAQ,GAAR;QACE,IAAI,CAAC,yBAAyB,EAAE,CAAC;QACjC,IAAI,CAAC,SAAS,EAAE,CAAC;IACnB,CAAC;IAED,uDAAyB,GAAzB;QAAA,iBAUC;QATC,MAAM,CAAC,aAAa,GAAG;YACrB,IAAM,MAAM,gBACP,KAAI,CAAC,MAAM,IACd,SAAS,EAAE,KAAI,CAAC,GAAG,EACnB,UAAU,EAAE,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAI,CAAC,EACrC,kBAAkB,EAAE,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAI,CAAC,GAC9C,CAAC;YACF,KAAI,CAAC,QAAQ,GAAG,KAAI,CAAC,MAAM,CAAC,KAAI,CAAC,OAAO,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;QAClE,CAAC,CAAC;IACJ,CAAC;IAED,6CAAe,GAAf;QACE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,iEAAS,CAAC,CAAC,OAAO,CAAC;QACpD,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAGD,mCAAK,GAAL;QACE,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;IACvB,CAAC;IAED;;;OAGG;IACK,2CAAa,GAArB;QACE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,kEAAU,CAAC,QAAQ,CAAC,CAAC;QAChD,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;IACxC,CAAC;IAED,wCAAU,GAAV,UAAY,GAAS;IACrB,CAAC;IAED,8CAAgB,GAAhB,UAAkB,EAAQ;QACxB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACrB,CAAC;IAED,+CAAiB,GAAjB,UAAmB,EAAQ;QACzB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;IACtB,CAAC;IAGD,uCAAS,GAAT;QAAA,iBAMC;QALC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;YACd,KAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC;YAC3B,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YACpB,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QACvB,CAAC,CAAC,CAAC;IACL,CAAC;IAGD,uCAAS,GAAT,UAAW,KAAc;QAAzB,iBAOC;QANC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;YACd,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YACxB,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACjC,KAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACrB,KAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACxB,CAAC,CAAC,CAAC;IACL,CAAC;IAGD,yCAAW,GAAX,UAAa,KAAc;QACzB,IAAI,CAAC,OAAO,CAAC,kBAAkB,CAAC,IAAI,CAAC,uBAAuB,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAClF,IAAI,CAAC,OAAO,CAAC,sBAAsB,EAAE,CAAC;IACxC,CAAC;IAGO,oCAAM,GAAd,UAAgB,OAAqB,EAAE,MAAM;QAC3C,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAC5C,CAAC;IAGD,mCAAK,GAAL;QACE,EAAE,EAAE,CAAC,IAAI,CAAC,QAAS,CAAC;YAAC,MAAM,CAAC;QAC5B,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IACtB,CAAC;IAGD,yCAAW,GAAX;QACE,EAAE,EAAE,CAAC,IAAI,CAAC,QAAS,CAAC;YAClB,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACjD,CAAC;IAGD,uCAAS,GAAT;QACE,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAC9C,IAAM,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,MAAM,GAAG,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;QACjD,MAAM,CAAC,GAAG,GAAG,iFAA+E,IAAM,CAAC;QACnG,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;QACpB,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;QACpB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;IACpC,CAAC;IAEH,0BAAC;AAAD,CAAC;AApHU;IAAR,4DAAK,EAAE;;gDAAc;AACb;IAAR,4DAAK,EAAE;;mDAA+B;AAC9B;IAAR,4DAAK,EAAE;;iDAAe;AAEb;IAAT,6DAAM,EAAE;;4DAA8C;AAC7C;IAAT,6DAAM,EAAE;;2DAAqC;AANnC,mBAAmB;IAZ/B,gEAAS,CAAC;QACT,QAAQ,EAAE,cAAc;QACxB,QAAQ,EAAE,YAAY;QACtB,SAAS,EAAE;YACT;gBACE,OAAO,EAAE,yEAAiB;gBAC1B,WAAW,EAAE,iEAAU,CAAC,cAAM,4BAAmB,EAAnB,CAAmB,CAAC;gBAClD,KAAK,EAAE,IAAI;aACZ;YACD,uBAAuB;SACxB;KACF,CAAC;qCAe+B,yDAAU,EAAoB,qDAAM,EAAqB,uDAAQ,EAAoC,uBAAuB;GAdhJ,mBAAmB,CAqH/B;AArH+B;;;;;;;;;;;;;;;;;;;;;;;;ACpDU;AACiD;AACvB;AACI;AAOxE,IAAa,SAAS;IASpB,mBAAoB,GAAkB,EAAU,IAAiB,EAAU,SAA0B,EAAU,WAA8B;QAAzH,QAAG,GAAH,GAAG,CAAe;QAAU,SAAI,GAAJ,IAAI,CAAa;QAAU,cAAS,GAAT,SAAS,CAAiB;QAAU,gBAAW,GAAX,WAAW,CAAmB;QAN7I,UAAK,GAAc,IAAI,iEAAS,CAAC;YAC/B,QAAQ,EAAE,IAAI,mEAAW,CAAC,IAAI,EAAE,kEAAU,CAAC,QAAQ,CAAC;YACpD,QAAQ,EAAE,IAAI,mEAAW,CAAC,IAAI,EAAE,kEAAU,CAAC,QAAQ,CAAC;YACpD,OAAO,EAAE,IAAI,mEAAW,EAAE;SAC3B,CAAC,CAAC;IAE6I,CAAC;IAEjJ,+BAA+B;IAC/B,8BAA8B;IAC9B,kCAAkC;IAClC,oBAAoB;IACpB,MAAM;IACN,sBAAsB;IACtB,IAAI;IAEG,iCAAa,GAApB;QACE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;IACjC,CAAC;IAEM,yBAAK,GAAZ;QAAA,iBAkBC;QAjBC,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,EAAE,EAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC;YAAC,MAAM,CAAC;QAC7B,IAAI,WAAW,GAAG;YAChB,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ;YACnC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ;SACpC,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,SAAS,CAAC,cAAI;YACzC,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;gBACjB,KAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC/C,KAAI,CAAC,GAAG,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YAChC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC3B,CAAC;QACH,CAAC,EACC,eAAK;YACH,KAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACxB,CAAC,CAAC,CAAC;IACP,CAAC;IAED,+BAAW,GAAX;QACE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACrC,OAAO,EAAE,gBAAgB;YACzB,mBAAmB,EAAE,IAAI;SAC1B,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IACzB,CAAC;IAED,6BAAS,GAAT,UAAU,IAAI;QACZ,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QAEvB,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YAChC,KAAK,EAAE,MAAM;YACb,QAAQ,EAAE,IAAI;YACd,OAAO,EAAE,CAAC,IAAI,CAAC;SAChB,CAAC,CAAC;QACH,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IACxB,CAAC;IACH,gBAAC;AAAD,CAAC;AA7DY,SAAS;IAJrB,gEAAS,CAAC;QACT,QAAQ,EAAE,YAAY;OACG;KAC1B,CAAC;cAU6I;AAoD9I;SA7DY,SAAS,e","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LoginPage } from './login';\n\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { DirectivesModule } from '../../directives/directives.module';\n\n@NgModule({\n  declarations: [\n    LoginPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LoginPage),\n    FormsModule,\n    ReactiveFormsModule,\n    DirectivesModule\n  ],\n  exports: [\n    LoginPage\n  ]\n})\nexport class LoginPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.module.ts","import { NgModule } from '@angular/core';\nimport {IonicModule} from 'ionic-angular';\n\nimport { IonCaptchaDirective } from './ion-captcha/ion-captcha';\n\n@NgModule({\n\tdeclarations: [IonCaptchaDirective],\n\timports: [IonicModule],\n\texports: [IonCaptchaDirective]\n})\nexport class DirectivesModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/directives/directives.module.ts","import { AfterViewInit, Directive, ElementRef, EventEmitter, forwardRef, Injectable, Injector, Input, NgZone, OnInit, Output } from '@angular/core';\nimport { AbstractControl, ControlValueAccessor, FormControl, NG_VALUE_ACCESSOR, NgControl, Validators } from '@angular/forms';\nimport { Http } from '@angular/http';\n\ndeclare const grecaptcha : any;\n\ndeclare global {\n  interface Window {\n    grecaptcha : any;\n    reCaptchaLoad : () => void\n  }\n}\n\n// export const RECAPTCHA_URL = new InjectionToken('RECAPTCHA_URL');\n\n@Injectable()\nclass ReCaptchaAsyncValidator {\n\n  constructor( private http : Http ) {\n  }\n\n  validateToken( token : string ) {\n    return ( _ : AbstractControl ) => {\n      return this.http.get('/validate_captcha', { params: { token } }).map(res => res.json()).map(res => {\n        if( !res.success ) {\n          return { tokenInvalid: true }\n        }\n        return null;\n      });\n    }\n  }\n}\n\nexport interface ReCaptchaConfig {\n  theme? : 'dark' | 'light';\n  type? : 'audio' | 'image';\n  size? : 'compact' | 'normal';\n  tabindex? : number;\n}\n\n@Directive({\n  selector: '[ionCaptcha]',\n  exportAs: 'ionCaptcha',\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => IonCaptchaDirective),\n      multi: true\n    },\n    ReCaptchaAsyncValidator\n  ]\n})\nexport class IonCaptchaDirective implements OnInit, AfterViewInit, ControlValueAccessor {\n  @Input() key : string;\n  @Input() config : ReCaptchaConfig = {};\n  @Input() lang : string;\n\n  @Output() captchaResponse = new EventEmitter<string>();\n  @Output() captchaExpired = new EventEmitter();\n\n  private control : FormControl;\n  private widgetId : number;\n\n  private onChange : ( value : string ) => void;\n  private onTouched : ( value : string ) => void;\n\n  constructor( private element : ElementRef, private  ngZone : NgZone, private injector : Injector, private reCaptchaAsyncValidator : ReCaptchaAsyncValidator ) {\n  }\n\n  ngOnInit() {\n    this.registerReCaptchaCallback();\n    this.addScript();\n  }\n\n  registerReCaptchaCallback() {\n    window.reCaptchaLoad = () => {\n      const config = {\n        ...this.config,\n        'sitekey': this.key,\n        'callback': this.onSuccess.bind(this),\n        'expired-callback': this.onExpired.bind(this)\n      };\n      this.widgetId = this.render(this.element.nativeElement, config);\n    };\n  }\n\n  ngAfterViewInit() {\n    this.control = this.injector.get(NgControl).control;\n    this.setValidators();\n  }\n\n\n  getId() {\n    return this.widgetId;\n  }\n\n  /**\n   * Calling the setValidators doesn't trigger any update or value change event.\n   * Therefore, we need to call updateValueAndValidity to trigger the update\n   */\n  private setValidators() {\n    this.control.setValidators(Validators.required);\n    this.control.updateValueAndValidity();\n  }\n\n  writeValue( obj : any ) : void {\n  }\n\n  registerOnChange( fn : any ) : void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched( fn : any ) : void {\n    this.onTouched = fn;\n  }\n\n\n  onExpired() {\n    this.ngZone.run(() => {\n      this.captchaExpired.emit();\n      this.onChange(null);\n      this.onTouched(null);\n    });\n  }\n\n\n  onSuccess( token : string ) {\n    this.ngZone.run(() => {\n      this.verifyToken(token);\n      this.captchaResponse.next(token);\n      this.onChange(token);\n      this.onTouched(token);\n    });\n  }\n\n\n  verifyToken( token : string ) {\n    this.control.setAsyncValidators(this.reCaptchaAsyncValidator.validateToken(token))\n    this.control.updateValueAndValidity();\n  }\n\n\n  private render( element : HTMLElement, config ) : number {\n    return grecaptcha.render(element, config);\n  }\n\n\n  reset() : void {\n    if( !this.widgetId ) return;\n    grecaptcha.reset(this.widgetId);\n    this.onChange(null);\n  }\n\n\n  getResponse() : string {\n    if( !this.widgetId )\n      return grecaptcha.getResponse(this.widgetId);\n  }\n\n\n  addScript() {\n    let script = document.createElement('script');\n    const lang = this.lang ? '&hl=' + this.lang : '';\n    script.src = `https://www.google.com/recaptcha/api.js?onload=reCaptchaLoad&render=explicit${lang}`;\n    script.async = true;\n    script.defer = true;\n    document.body.appendChild(script);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/directives/ion-captcha/ion-captcha.ts","import { Component } from '@angular/core';\nimport { NavController, AlertController, LoadingController, Loading, IonicPage } from 'ionic-angular';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { AuthService } from '../../providers/auth-service/auth-service';\n\n@IonicPage({\n  name: 'login-page'\n})\n@Component({\n  selector: 'page-login',\n  templateUrl: 'login.html'\n})\nexport class LoginPage {\n  loading: Loading;\n\n  logIn: FormGroup = new FormGroup({\n    username: new FormControl(null, Validators.required),\n    password: new FormControl(null, Validators.required),\n    captcha: new FormControl()\n  });\n\n  constructor(private nav: NavController, private auth: AuthService, private alertCtrl: AlertController, private loadingCtrl: LoadingController) {}\n\n  // ionViewCanEnter(): boolean {\n  //   if(this.auth.loggedIn()){\n  //     this.nav.setRoot(HomePage);\n  //     return false;\n  //   }\n  //   else return true;\n  // }\n\n  public createAccount() {\n    this.nav.push('register-page');\n  }\n\n  public login() {\n    this.showLoading();\n    if(!this.logIn.valid) return;\n    let credentials = {\n      username: this.logIn.value.username,\n      password: this.logIn.value.password\n    };\n    this.auth.login(credentials).subscribe(data => {\n      if (data.success) {\n        this.auth.storeUserData(data.token, data.user);\n        this.nav.setRoot('tabs-page');\n      } else {\n        this.showError(data.msg);\n      }\n    },\n      error => {\n        this.showError(error);\n      });\n  }\n\n  showLoading() {\n    this.loading = this.loadingCtrl.create({\n      content: 'Please wait...',\n      dismissOnPageChange: true\n    });\n    this.loading.present();\n  }\n\n  showError(text) {\n    this.loading.dismiss();\n\n    let alert = this.alertCtrl.create({\n      title: 'Fail',\n      subTitle: text,\n      buttons: ['OK']\n    });\n    alert.present(prompt);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.ts"],"sourceRoot":""}