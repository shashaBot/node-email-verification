{"version":3,"sources":["../../src/pages/view/view.module.ts","../../src/pages/view/view.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ViewPage } from './view';\n\n@NgModule({\n  declarations: [\n    ViewPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ViewPage),\n  ],\n})\nexport class ViewPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/view/view.module.ts","import { Component, ViewChild, AfterViewInit, Renderer2 } from '@angular/core';\nimport { IonicPage, NavController, NavParams, LoadingController, Loading } from 'ionic-angular';\nimport { SessionProvider } from '../../providers/session/session';\n\n@IonicPage({\n  name: 'view-page'\n})\n@Component({\n  selector: 'page-view',\n  templateUrl: 'view.html',\n})\nexport class ViewPage implements AfterViewInit {\n  public session;\n  public file;\n  public dataUrl;\n  private token: string;\n\n  public loading: Loading;\n  public mediaLoading: Loading\n  public leaving: Boolean = false;\n\n  private fileIndex: number = 0;\n  @ViewChild('videoPlayer') videoPlayer;\n  @ViewChild('audioPlayer') audioPlayer;\n  @ViewChild('image') imageEl;\n  @ViewChild('mediaContainer') mediaContainer;\n  // baseUrl: string = 'http://localhost:8080/';\n  baseUrl: string = 'https://ionic-node-auth.herokuapp.com/';\n  apiUrl: string = 'session/stream_files?path='\n\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    private sessionSer: SessionProvider,\n    private ren: Renderer2,\n    private loadingCtrl: LoadingController) {\n\n    this.session = this.navParams.get('session');\n    this.token = this.navParams.get('token');\n    // this.streamFile(this.fileIndex);\n  }\n\n  ngAfterViewInit() {\n    this.playFile(this.session.files[0]);\n  }\n\n  playFile (file) {\n    if(!file) return this.navCtrl.pop();\n    if(this.leaving) return;\n    this.file = file;\n    let mediaDiv = this.mediaContainer.nativeElement;\n    let type = file.type;\n    let mediaEl, sourceEl, audioImg;\n    if(type.indexOf('image/') !== -1){\n      mediaEl = this.ren.createElement('img');\n      this.ren.setAttribute(mediaEl, 'src', this.baseUrl+this.apiUrl+file.path);\n      this.ren.listen(mediaEl, 'load', (e) => {\n        setTimeout(() => {\n          console.log('file ended!');\n          this.fileIndex++;\n          this.ren.removeChild(mediaDiv, mediaEl);\n          this.playFile(this.session.files[this.fileIndex]);\n        }, 5000);\n      });\n    }\n    if(type.indexOf('audio/') !== -1){\n      if(!mediaEl)\n        mediaEl = this.ren.createElement('audio');\n      if(!sourceEl)\n        sourceEl = this.ren.createElement('source');\n      this.ren.setProperty(mediaEl, 'autoplay', 'true');\n      // this.ren.setProperty(mediaEl, 'controls', 'true');\n      this.ren.setProperty(sourceEl, 'src', this.baseUrl+this.apiUrl+file.path);\n      this.ren.appendChild(mediaEl, sourceEl);\n      if(!audioImg){\n        audioImg = this.ren.createElement('img');\n        this.ren.setAttribute(audioImg, 'src', 'assets/icon/headphones-icon.png');\n        this.ren.addClass(audioImg, 'audio-img');\n      }\n      this.ren.appendChild(mediaDiv, audioImg);\n      this.ren.listen(mediaEl, 'ended', (e) => {\n        console.log('file ended!');\n        this.fileIndex++;\n        this.ren.removeChild(mediaDiv, audioImg);\n        this.ren.removeChild(mediaDiv, mediaEl);\n        this.playFile(this.session.files[this.fileIndex]);\n      });\n      this.ren.listen(mediaEl, 'loadstart', (e) => {\n        if(!this.mediaLoading)\n          this.showMediaLoading();\n      })\n      this.ren.listen(mediaEl, 'play', (e) => {\n        if(this.mediaLoading)\n          this.mediaLoading.dismiss();\n      });\n      this.ren.listen(mediaEl, 'waiting', (e) => {\n        if(!this.mediaLoading)\n          this.showMediaLoading();\n      });\n    }\n    if(type.indexOf('video/') !== -1) {\n      mediaEl = this.ren.createElement('video');\n      sourceEl = this.ren.createElement('source');\n      this.ren.setProperty(mediaEl, 'autoplay', 'true');\n      // this.ren.setProperty(mediaEl, 'controls', 'true');\n      this.ren.setProperty(sourceEl, 'src', this.baseUrl+this.apiUrl+file.path);\n      this.ren.appendChild(mediaEl, sourceEl);\n      this.ren.listen(mediaEl, 'ended', (e) => {\n        console.log('file ended!');\n        this.fileIndex++;\n        this.ren.removeChild(mediaDiv, mediaEl);\n        this.playFile(this.session.files[this.fileIndex]);\n      });\n      this.ren.listen(mediaEl, 'loadstart', (e) => {\n        this.showMediaLoading();\n      })\n      this.ren.listen(mediaEl, 'play', (e) => {\n        if(this.mediaLoading)\n          this.mediaLoading.dismiss();\n      });\n      this.ren.listen(mediaEl, 'waiting', (e) => {\n        if(!this.mediaLoading)\n          this.showMediaLoading();\n      });\n    }\n    this.ren.appendChild(mediaDiv, mediaEl);\n  }\n\n  // streamFile(index: number) : void {\n  //   this.file = this.session.files[index];\n  //   this.sessionSer.stream(this.file).subscribe( data => {\n  //     this.dataUrl = this.makeDataUrl(data);\n  //   });\n  // }\n\n  onFileEnd () {\n    console.log('file ended!');\n    if(this.fileIndex !== this.session.files.length -1)\n      this.fileIndex++;\n    // this.streamFile(this.fileIndex);\n  }\n\n  onImageLoaded() {\n    if(this.loading)\n      this.loading.dismiss();\n    setTimeout(() => {\n      this.onFileEnd();\n    }, 5000);\n  }\n\n  // makeDataUrl(buffer) {\n  //   var binary = '';\n  //   var bytes = new Uint8Array( buffer );\n  //   var len = bytes.byteLength;\n  //   for (var i = 0; i < len; i++) {\n  //       binary += String.fromCharCode( bytes[ i ] );\n  //   }\n  //   return window.btoa( binary );\n  // }\n\n  ionViewDidLoad() {\n    this.leaving = false;\n    console.log('ionViewDidLoad ViewPage');\n  }\n\n  ionViewWillLeave() {\n    this.leaving = true;\n    // if(this.token) {\n    //   this.sessionSer.removeViewedToken(this.token).subscribe( res => {\n    //     console.log(res);\n    //   });\n    // }\n  }\n\n  showLoading() {\n    this.loading = this.loadingCtrl.create({\n      content: 'Please wait...',\n      dismissOnPageChange: true\n    });\n    this.loading.present();\n  }\n\n  showMediaLoading () {\n    this.mediaLoading = this.loadingCtrl.create({\n      content: 'Buffering...',\n      spinner: 'circles',\n      dismissOnPageChange: false\n    });\n    this.mediaLoading.present();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/view/view.ts"],"sourceRoot":""}